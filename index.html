<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPFS Evolutive Knowledge Capsule - Git Versioned Nostr Distribution</title>
    <script src="frd/marked.min.js"></script>
    <link rel="stylesheet" href="frd/github-dark.min.css">
    <script src="frd/highlight.min.js"></script>
    <link rel="stylesheet" href="frd/katex.min.css">
    <script defer src="frd/katex.min.js"></script>
    <script defer src="frd/auto-render.min.js"></script>
    <style>
        :root { --bg: #0d1117; --fg: #f0f6fc; --accent: #ffd700; --blue: #58a6ff; --border: #30363d; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--fg); line-height: 1.6; margin: 0; }
        .header { background: #161b22; border-bottom: 1px solid var(--border); padding: 15px 20px; text-align: center; }
        .header h1 { color: var(--accent); margin: 0; font-size: 1.5rem; }
        .header p { color: #8b949e; margin: 5px 0 0 0; font-size: 0.9rem; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .markdown-content { background: var(--bg); }
        .markdown-content h1 { color: var(--accent); border-bottom: 2px solid var(--border); padding-bottom: 10px; margin-bottom: 30px; }
        .markdown-content h2 { color: var(--blue); margin-top: 40px; margin-bottom: 20px; }
        .markdown-content h3 { color: var(--fg); margin-top: 30px; margin-bottom: 15px; }
        .markdown-content code { background: #161b22; padding: 2px 6px; border-radius: 3px; color: var(--accent); }
        .markdown-content pre { background: #161b22; padding: 16px; border-radius: 6px; overflow-x: auto; margin: 20px 0; border: 1px solid var(--border); }
        .markdown-content pre code { background: none; padding: 0; color: var(--fg); }
        .markdown-content a { color: var(--blue); text-decoration: none; }
        .markdown-content a:hover { text-decoration: underline; }
        .markdown-content blockquote { border-left: 4px solid var(--accent); padding-left: 16px; margin: 20px 0; background: #161b22; padding: 16px; border-radius: 6px; font-style: italic; }
        .markdown-content table { border-collapse: collapse; width: 100%; margin: 20px 0; background: #161b22; border-radius: 6px; overflow: hidden; }
        .markdown-content th, .markdown-content td { border: 1px solid var(--border); padding: 12px; text-align: left; }
        .markdown-content th { background: #21262d; color: var(--accent); font-weight: 600; }
        .markdown-content ul, .markdown-content ol { margin: 16px 0; padding-left: 30px; }
        .markdown-content li { margin-bottom: 8px; }
        .loading { text-align: center; padding: 60px; color: #8b949e; }
        @media (max-width: 768px) { .container { padding: 10px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì° FRD Knowledge Capsule</h1>
        <p>IPFS Evolutive Knowledge - Git Versioned Nostr Distribution</p>
    </div>
    <div class="container">
        <div id="content" class="markdown-content">
            <div class="loading">‚è≥ Chargement de la documentation...</div>
        </div>
    </div>
    <script>
        marked.setOptions({ 
            highlight: (code, lang) => lang && hljs.getLanguage(lang) ? hljs.highlight(code, { language: lang }).value : hljs.highlightAuto(code).value, 
            breaks: true, 
            gfm: true 
        });
        
        async function loadReadme() {
            const content = document.getElementById('content');
            try {
                const response = await fetch('README.md');
                if (!response.ok) throw new Error(`Erreur ${response.status}`);
                const markdown = await response.text();
                
                // Parser le markdown
                let html = marked.parse(markdown);
                
                // Transformer les liens .md en liens qui rechargent dans la m√™me page
                html = html.replace(/href="([^"]+\.md)"/g, 'href="#" onclick="loadMarkdownFile(\'$1\'); return false;"');
                
                content.innerHTML = html;
                
                // Rendu des formules math√©matiques
                if (window.renderMathInElement) {
                    renderMathInElement(content, { 
                        delimiters: [
                            {left: '$$', right: '$$', display: true}, 
                            {left: '$', right: '$', display: false},
                            {left: '\\[', right: '\\]', display: true},
                            {left: '\\(', right: '\\)', display: false}
                        ] 
                    });
                }
                
                // G√©rer les ancres apr√®s le chargement
                handleAnchors();
            } catch (error) {
                content.innerHTML = `<h1>‚ùå Erreur</h1><p>Impossible de charger README.md</p><p>D√©tails: ${error.message}</p>`;
            }
        }
        
        async function loadMarkdownFile(filename) {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">‚è≥ Chargement de ' + filename + '...</div>';
            try {
                const response = await fetch(filename);
                if (!response.ok) throw new Error(`Erreur ${response.status}`);
                const markdown = await response.text();
                
                let html = marked.parse(markdown);
                
                // Ajouter un bouton retour
                html = '<div style="margin-bottom: 20px;"><a href="#" onclick="loadReadme(); return false;" style="background: #21262d; padding: 8px 16px; border-radius: 6px; text-decoration: none; color: var(--blue);">‚Üê Retour au README</a></div>' + html;
                
                // Transformer les liens .md
                html = html.replace(/href="([^"]+\.md)"/g, 'href="#" onclick="loadMarkdownFile(\'$1\'); return false;"');
                
                content.innerHTML = html;
                
                if (window.renderMathInElement) {
                    renderMathInElement(content, { 
                        delimiters: [
                            {left: '$$', right: '$$', display: true}, 
                            {left: '$', right: '$', display: false},
                            {left: '\\[', right: '\\]', display: true},
                            {left: '\\(', right: '\\)', display: false}
                        ] 
                    });
                }
                
                // G√©rer les ancres apr√®s le chargement ou scroll vers le haut
                if (window.location.hash) {
                    handleAnchors();
                } else {
                    window.scrollTo(0, 0);
                }
            } catch (error) {
                content.innerHTML = `<h1>‚ùå Erreur</h1><p>Impossible de charger ${filename}</p><p>D√©tails: ${error.message}</p>`;
            }
        }
        
        // Fonction pour g√©rer les ancres
        function handleAnchors() {
            // G√©rer l'ancre dans l'URL au chargement
            if (window.location.hash) {
                setTimeout(() => {
                    const element = document.querySelector(window.location.hash);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                        // Ajouter un effet de surbrillance temporaire
                        element.style.backgroundColor = 'rgba(255, 215, 0, 0.2)';
                        setTimeout(() => {
                            element.style.backgroundColor = '';
                        }, 2000);
                    }
                }, 100);
            }
        }
        
        // G√©rer les changements d'ancre
        window.addEventListener('hashchange', handleAnchors);
        
        // Charger README.md au d√©marrage
        document.addEventListener('DOMContentLoaded', () => {
            loadReadme();
            // G√©rer l'ancre initiale apr√®s un petit d√©lai
            setTimeout(handleAnchors, 500);
        });
    </script>
</body>
</html>
